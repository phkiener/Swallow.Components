@implements IDisposable

@foreach (var (key, value) in persistedState)
{
    <meta itemprop="state" data-key="@key" data-value="@value">
}

@code {

    private IReadOnlyDictionary<string, string> persistedState = new Dictionary<string, string>();

    [Inject]
    internal ComponentStateStore Store { get; set; } = null!;

    protected override void OnInitialized()
    {
        Store.OnStatePersisted += ReloadState;
    }

    private void ReloadState(object? sender, IReadOnlyDictionary<string, string> serializedState)
    {
        persistedState = serializedState;

        StateHasChanged();
    }

    public void Dispose()
    {
        Store.OnStatePersisted -= ReloadState;
    }

}
